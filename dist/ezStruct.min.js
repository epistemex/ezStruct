/*
	ezStruct ver 0.1.1-alpha
	Copyright (c) 2018 Epistemex
	www.epistemex.com
*/
"use strict";var ezStruct=(function(){var a=[];return{enums:{UINT8:0,UBYTE:0,UINT16:1,USHORT:1,UINT32:2,UINT:2,UINT64:3,ULONG:3,INT8:4,BYTE:4,BOOL:4,INT16:5,SHORT:5,INT32:6,INT:6,INT64:7,LONG:7,FLOAT32:8,FLOAT:8,FLOAT64:9,DOUBLE:9,CHAR:10,BYTES:10,STRING:11,STRUCT:12},define:function(c){var d={name:c,defs:[]},b;for(b=0;b<a.length;b++){if(a[b].name===c){throw"Structure with this name exists."}}a.push(d);return{def:function(g,e,f){if(g<0||g>ezStruct.TMPenums.STRUCT){throw"Invalid type."}d.defs.push({name:e,type:g,opt:f})}}},alloc:function(B,z){var D,y,C=0,A={},E=[];for(y=0;y<a.length;y++){if(a[y].name===B){D=a[y];break}}if(!D){throw"Structure not defined."}D.defs.forEach(function(i){var G=ezStruct.TMPenums;switch(i.type){case G.UINT8:b(i.name,n,x,C,C+1);C++;break;case G.UINT16:b(i.name,l,v,C,C+2);C+=2;break;case G.UINT32:b(i.name,m,w,C,C+4);C+=4;break;case G.INT8:b(i.name,h,t,C,C+1);C++;break;case G.INT16:b(i.name,f,r,C,C+2);C+=2;break;case G.INT32:b(i.name,g,s,C,C+4);C+=4;break;case G.FLOAT32:b(i.name,d,p,C,C+4);C+=4;break;case G.FLOAT64:b(i.name,e,q,C,C+8);C+=8;break;case G.CHAR:b(i.name,c,o,C,i.opt);C+=i.opt;break;case G.STRING:b(i.name,j,u,C,i.opt);C+=i.opt;break;case G.STRUCT:var F=ezStruct.alloc(i.opt,z);E.push({struct:F,pos:C,len:F.uint8.length});Object.defineProperty(A,i.name,{get:k.bind({struct:F})});C+=F.uint8.length;break}});A.buffer=new ArrayBuffer(C);A.view=new DataView(A.buffer);A.uint8=new Uint8Array(A.buffer);A.name=D.name;A.length=A.uint8.length;E.forEach(function(i){i.struct.buffer=A.buffer;i.struct.uint8=new Uint8Array(A.buffer,i.pos,i.len);i.struct.view=new DataView(A.buffer,i.pos,i.len)});function b(G,F,I,H,J){Object.defineProperty(A,G,{get:F.bind(i(H,J)),set:I.bind(i(H,J))});function i(L,K){return{m:A,pos:L,len:K,le:!!z}}}function h(){return this.m.view.getInt8(this.pos)}function t(i){this.m.view.setInt8(this.pos,i)}function f(){return this.m.view.getInt16(this.pos,this.le)}function r(i){this.m.view.setInt16(this.pos,i,this.le)}function g(){return this.m.view.getInt32(this.pos,this.le)}function s(i){this.m.view.setInt32(this.pos,i,this.le)}function n(){return this.m.view.getUint8(this.pos)}function x(i){this.m.view.setUint8(this.pos,i)}function l(){return this.m.view.getUint16(this.pos,this.le)}function v(i){this.m.view.setUint16(this.pos,i,this.le)}function m(){return this.m.view.getUint32(this.pos,this.le)}function w(i){this.m.view.setUint32(this.pos,i,this.le)}function d(){return this.m.view.getFloat32(this.pos,this.le)}function p(i){this.m.view.setFloat32(this.pos,i,this.le)}function e(){return this.m.view.getFloat64(this.pos,this.le)}function q(i){this.m.view.setFloat64(this.pos,i,this.le)}function c(){return this.m.uint8.subarray(this.pos,this.len)}function o(i){if(i.length>this.len){throw"Illegal size."}this.m.uint8.set(i,this.pos)}function j(){var F=this.m.uint8.subarray(this.pos,this.pos+this.len),G=F.indexOf(0);return new TextDecoder().decode(G<0?F:F.subarray(0,G))}function u(F){var i=new TextEncoder().encode(F+"\0");if(i.length>this.len){throw"Illegal size."}this.m.uint8.set(i,this.pos)}function k(){return this.struct}return A},fromBuffer:function(e,b,c){var d=ezStruct.alloc(e,c);if(ArrayBuffer.isView(b)){b=b.buffer}d.uint8.set(new Uint8Array(b,0,Math.min(d.length,b.byteLength)));return d},clone:function(c){var b=ezStruct.alloc(c.name);b.uint8.set(c.uint8.slice(0,b.length));return b}}})();