/*
	ezStruct ver 0.1.0-alpha
	Copyright (c) 2018 Epistemex
	www.epistemex.com
*/
"use strict";var ezStruct=(function(){var a=[];return{enums:{UINT8:0,UBYTE:1,UINT16:2,USHORT:2,UINT32:3,UINT:3,UINT64:4,ULONG:4,INT8:5,BYTE:5,BOOL:5,INT16:6,SHORT:6,INT32:7,INT:7,INT64:9,LONG:9,FLOAT32:10,FLOAT:10,FLOAT64:11,DOUBLE:11,CHAR:14,STRING:15,STRUCT:16},define:function(c){var d={name:c,defs:[]},b;for(b=0;b<a.length;b++){if(a[b].name===c){throw"Structure with this name exists."}}a.push(d);return{def:function(g,e,f){d.defs.push({name:e,type:g,opt:f})}}},alloc:function(B,z){var D,y,C=0,A={},E=[];for(y=0;y<a.length;y++){if(a[y].name===B){D=a[y];break}}if(!D){throw"Structure with name not defined."}A._struct=D;D.defs.forEach(function(i){var G=ezStruct.TMPenums;switch(i.type){case G.UINT8:b(i.name,n,x,C,C+1);C++;break;case G.UINT16:b(i.name,l,v,C,C+2);C+=2;break;case G.UINT32:b(i.name,m,w,C,C+4);C+=4;break;case G.INT8:b(i.name,h,t,C,C+1);C++;break;case G.INT16:b(i.name,f,r,C,C+2);C+=2;break;case G.INT32:b(i.name,g,s,C,C+4);C+=4;break;case G.FLOAT32:b(i.name,d,p,C,C+4);C+=4;break;case G.FLOAT64:b(i.name,e,q,C,C+8);C+=8;break;case G.CHAR:b(i.name,c,o,C,i.opt);C+=i.opt;break;case G.STRING:b(i.name,j,u,C,i.opt);C+=i.opt;break;case G.STRUCT:var F=ezStruct.alloc(i.opt);E.push({struct:F,pos:C,len:F.uint8.length});Object.defineProperty(A,i.name,{get:k.bind({struct:F})});C+=F.uint8.length;break}});A.buffer=new ArrayBuffer(C);A.view=new DataView(A.buffer);A.uint8=new Uint8Array(A.buffer);A.name=D.name;A.length=A.uint8.length;E.forEach(function(i){i.struct.buffer=A.buffer;i.struct.uint8=new Uint8Array(A.buffer,i.pos,i.len);i.struct.view=new DataView(A.buffer,i.pos,i.len)});function b(G,F,I,H,J){Object.defineProperty(A,G,{get:F.bind(i(H,J)),set:I.bind(i(H,J))});function i(L,K){return{mem:A,cfg:{pos:L,len:K},le:!!z}}}function h(){return this.mem.view.getInt8(this.cfg.pos)}function t(i){return this.mem.view.setInt8(this.cfg.pos,i)}function f(){return this.mem.view.getInt16(this.cfg.pos,this.cfg.le)}function r(i){return this.mem.view.setInt16(this.cfg.pos,i,this.cfg.le)}function g(){return this.mem.view.getInt32(this.cfg.pos,this.cfg.le)}function s(i){return this.mem.view.setInt32(this.cfg.pos,i,this.cfg.le)}function n(){return this.mem.view.getUint8(this.cfg.pos)}function x(i){return this.mem.view.setUint8(this.cfg.pos,i)}function l(){return this.mem.view.getUint16(this.cfg.pos,this.cfg.le)}function v(i){return this.mem.view.setUint16(this.cfg.pos,i,this.cfg.le)}function m(){return this.mem.view.getUint32(this.cfg.pos,this.cfg.le)}function w(i){return this.mem.view.setUint32(this.cfg.pos,i,this.cfg.le)}function d(){return this.mem.view.getFloat32(this.cfg.pos,this.cfg.le)}function p(i){return this.mem.view.setFloat32(this.cfg.pos,i,this.cfg.le)}function e(){return this.mem.view.getFloat64(this.cfg.pos,this.cfg.le)}function q(i){return this.mem.view.setFloat64(this.cfg.pos,i,this.cfg.le)}function c(){return this.mem.uint8.subarray(this.cfg.pos,this.cfg.len)}function o(i){if(i.length>this.cfg.len){throw"Illegal size."}this.mem.uint8.set(i,this.cfg.pos)}function j(){var F=this.mem.uint8.subarray(this.cfg.pos,this.cfg.pos+this.cfg.len),G=F.indexOf(0);return new TextDecoder().decode(G<0?F:F.subarray(0,G))}function u(F){var i=new TextEncoder().encode(F+"\0");if(i.length>this.cfg.len){throw"Illegal size."}this.mem.uint8.set(i,this.cfg.pos)}function k(){return this.struct}return A}}})();